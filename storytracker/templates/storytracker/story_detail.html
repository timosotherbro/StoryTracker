{% extends "storytracker/base.html" %}

{% block title %}{{ story.title }} â€“ StoryTracker{% endblock %}

{% block content %}
  <p>
    <a href="{% url 'storytracker:story_list' %}">&larr; Back to all stories</a>
  </p>

  <h1 class="h3">{{ story.title }}</h1>

  <p><strong>Genre:</strong> {{ story.genre|default:"(none)" }}</p>
  <p><strong>Tags:</strong> {{ story.tags|default:"(none)" }}</p>

  <h2 class="h5 mt-4">Summary</h2>
  <p>{{ story.summary|linebreaks }}</p>

  <p class="mt-3">
    <a class="btn btn-sm btn-outline-secondary"
       href="{% url 'storytracker:edit_story' story.id %}">
      Edit story
    </a>
    <a class="btn btn-sm btn-primary"
       href="{% url 'storytracker:new_update' story.id %}">
      Add update
    </a>

    <form method="post"
          action="{% url 'storytracker:delete_story' story.id %}"
          style="display:inline;">
      {% csrf_token %}
      <button type="submit"
              class="btn btn-sm btn-danger"
              onclick="return confirm('Delete this story and all its updates?');">
        Delete story
      </button>
    </form>
  </p>

  <h2 class="h5 mt-4">Updates</h2>
  {% if updates %}
    <ul class="list-group">
      {% for update in updates %}
        <li class="list-group-item">
          <div class="d-flex justify-content-between">
            <div>
              <strong>{{ update.created_at|date:"Y-m-d H:i" }}</strong><br>
              {{ update.note|linebreaks }}
              {% if update.words_added %}
                <br><em>Words added: {{ update.words_added }}</em>
              {% endif %}
            </div>
            <form method="post"
                  action="{% url 'storytracker:delete_update' update.id %}">
              {% csrf_token %}
              <button type="submit"
                      class="btn btn-sm btn-outline-danger"
                      onclick="return confirm('Delete this update?');">
                Delete
              </button>
            </form>
          </div>
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p>No updates yet.</p>
  {% endif %}
{% endblock %}
